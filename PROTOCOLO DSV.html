<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protocolo de Actuación - GAD</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; padding-bottom: 50px; }
        .container { background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        .btn { padding: 10px 16px; border-radius: 5px; font-size: 14px; cursor: pointer; }
        .btn-primary { background-color: #3b82f6; color: white; }
        .btn-back { background-color: #90EE90; color: #333; }
        .result-box { margin-top: 20px; padding: 15px; border-radius: 5px; border: 1px solid; }
        .result-box.delito { background-color: #f8d7da; border-color: #f5c6cb; color: #721c24; }
        .result-box.infraccion { background-color: #ffeeba; border-color: #ffc720; color: #664d03; }
        .result-box.ok { background-color: #d4edda; border-color: #c3e6cb; color: #155724; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col pb-16">

    <header class="bg-blue-600 w-full flex justify-center items-center py-2">
        <div class="w-40 h-40 rounded-full overflow-hidden shadow-lg">
            <img src="logogad.png" alt="Logo GAD" class="w-full h-full object-cover block">
        </div>
    </header>

    <h1 class="text-black text-center mt-6 text-xl font-bold px-4">
        PROTOCOLO PERMISOS DSV
    </h1>

    <div class="w-11/12 max-w-md mx-auto mt-4 bg-white p-4 rounded-lg shadow-md container">
<p class="text-gray-700 font-bold uppercase">SELECCIONE EL SUPUESTO PARA COMENZAR:</p>
        <div id="supuestos-container" class="mt-4 flex flex-col gap-2"></div>

        <div id="question-container" class="mt-6"></div>

        <div id="resultado" class="hidden result-box mt-6">
            <h2 class="text-lg font-bold mb-2">Detalles del Caso</h2>
            <div id="detalle-caso"></div>
        </div>

        <button onclick="window.location.href='index.html'" class="w-full p-4 bg-yellow-400 text-black font-bold rounded-lg shadow-md mt-6 transition hover:bg-yellow-200">
            <i class="fas fa-arrow-left"></i> VOLVER AL MENÚ PRINCIPAL
        </button>
    </div>

    <footer class="mt-auto text-center py-6 bg-gray-200">
        <hr class="border-t border-gray-400 w-11/12 max-w-md mx-auto mb-4">
        <p class="font-bold">GRUPO DE ANÁLISIS DOCUMENTAL</p>
        <p class="font-bold">POLICÍA LOCAL DE ALICANTE</p>
        <p>&copy; GAD - Todos los derechos reservados</p>
    </footer>

    <script>
        // --- Árboles de decisiones ---
        const decisionTrees = {
            "perdida-puntos": {
                question: "¿CONDUCE DURANTE EL PERIODO DE PÉRDIDA DE VIGENCIA?",
                options: {
                    "SI": "conduce-durante",
                    "FINALIZADO SIN CURSO NI EXAMEN": "finalizado-no-curso-examen",
                    "FINALIZADO CON CURSO SIN EXAMEN": "finalizado-no-examen",
                    "FINALIZADO CON CURSO Y EXAMEN": "finalizado-si-examen",
                    "NO TIENE CONOCIMIENTO EDICTAL": "no-conocimiento",
                    "EN RECURSO DE ALZADA": "incidencias-recurso",
                    "PENDIENTE DE RECURSO": "incidencias-pendiente",
                    "CONDUCIR CON PÉRDIDA (SOLO ESPAÑA)": "conducir-con-perdida"
                }
            },
            "suspension-judicial": {
                question: "¿LA CONDENA ES MAYOR A 2 AÑOS?",
                options: {
                    "NO": {
                        question: "¿CUÁNDO CONDUCE?",
                        options: {
                            "DENTRO": "dentro-condena-menor",
                            "FINALIZADO SIN CURSO": "finalizado-condena-menor-no-curso",
                            "FINALIZADO CON CURSO": "finalizado-condena-menor-si-curso"
                        }
                    },
                    "SI": {
                        question: "¿CUÁNDO CONDUCE?",
                        options: {
                            "DENTRO": "dentro-condena-mayor",
                            "FINALIZADO SIN CURSO NI EXAMEN": "finalizado-condena-mayor-no-curso-examen",
                            "FINALIZADO CON CURSO Y EXAMEN": "finalizado-condena-mayor-si-curso-examen"
                        }
                    }
                }
            },
            "carencia": {
                question: "¿HA OBTENIDO ALGUNA VEZ EL PERMISO?",
                options: {
                    "NO": "nunca-obtenido",
                    "TIENE PERMISO DE OTRO TIPO/PAÍS": "carecer-permiso"
                }
            },
            "psicofisicas": {
                question: "¿ES PÉRDIDA DE VIGENCIA O FALTA DE REQUISITOS?",
                options: {
                    "PÉRDIDA DE VIGENCIA": "perdida-psicofisicas",
                    "SIN REQUISITOS EXIGIDOS": "sin-requisitos"
                }
            }
        };

        // --- Casos finales ---
        const casos = {
            // PERDIDA DE PUNTOS
            "conduce-durante": { hecho: "Conduce durante periodo de pérdida de vigencia", resumen: "DELITO LSV art.384 CP - ATESTADO", actuacion: "Diligencias + denuncia 1.1.5A RGCond. NO copia al denunciado + Inmovilización.", tipo: "delito" },
            "finalizado-no-curso-examen": { hecho: "Finalizado periodo SIN curso NI examen", resumen: "DELITO LSV art.384 CP - ATESTADO", actuacion: "Diligencias + denuncia 1.1.5A RGCond. NO copia al denunciado + Inmovilización.", tipo: "delito" },
            "finalizado-no-examen": { hecho: "Finalizado periodo CON curso SIN examen", resumen: "DELITO LSV art.384 CP - ATESTADO", actuacion: "Diligencias + denuncia 1.1.5A RGCond. NO copia al denunciado + Inmovilización.", tipo: "delito" },
            "finalizado-si-examen": { hecho: "Finalizado periodo CON curso Y examen", resumen: "OK - CONTINÚA VIAJE", actuacion: "Situación regularizada.", tipo: "ok" },
            "no-conocimiento": { hecho: "No tiene conocimiento edictal", resumen: "INFRACCIÓN RGCOND 1.1.5A (500€)", actuacion: "Denuncia + Inmovilización. NO penal.", tipo: "infraccion" },
            "incidencias-recurso": { hecho: "En recurso de alzada", resumen: "INFRACCIÓN RGCOND 1.1.5A (500€)", actuacion: "Denuncia + Inmovilización. NO penal.", tipo: "infraccion" },
            "incidencias-pendiente": { hecho: "Pendiente de recurso", resumen: "INFRACCIÓN RGCOND 1.1.5A (500€)", actuacion: "Denuncia + Inmovilización. NO penal.", tipo: "infraccion" },
            "conducir-con-perdida": { hecho: "Conducir con pérdida de vigencia (España)", resumen: "DELITO LSV art.384 CP - ATESTADO", actuacion: "Diligencias + denuncia 1.1.5A RGCond. NO copia al denunciado + Inmovilización.", tipo: "delito" },

            // SUSPENSIÓN JUDICIAL
            "dentro-condena-menor": { hecho: "Condena ≤ 2 años: dentro del periodo", resumen: "DELITO LSV art.384 CP - ATESTADO", actuacion: "Diligencias + denuncia 1.1.5D RGCond. NO copia + Inmovilización.", tipo: "delito" },
            "finalizado-condena-menor-no-curso": { hecho: "Condena ≤ 2 años: finalizado sin curso", resumen: "INFRACCIÓN RGCOND 1.1.5D (200€)", actuacion: "Denuncia. Se entrega copia. NO penal.", tipo: "infraccion" },
            "finalizado-condena-menor-si-curso": { hecho: "Condena ≤ 2 años: finalizado con curso", resumen: "OK - CONTINÚA VIAJE", actuacion: "Situación regularizada.", tipo: "ok" },
            "dentro-condena-mayor": { hecho: "Condena > 2 años: dentro del periodo", resumen: "DELITO LSV art.384 CP - ATESTADO", actuacion: "Diligencias + denuncia 1.1.5A RGCond. NO copia + Inmovilización.", tipo: "delito" },
            "finalizado-condena-mayor-no-curso-examen": { hecho: "Condena > 2 años: finalizado sin curso ni examen", resumen: "DELITO QUEBRANTAMIENTO art.468 CP", actuacion: "Diligencias por quebrantamiento + denuncia 1.1.5A RGCond. NO copia + Inmovilización.", tipo: "delito" },
            "finalizado-condena-mayor-si-curso-examen": { hecho: "Condena > 2 años: finalizado con curso y examen", resumen: "OK - CONTINÚA VIAJE", actuacion: "Situación regularizada.", tipo: "ok" },

            // CARENCIA
            "nunca-obtenido": { hecho: "Nunca ha obtenido permiso", resumen: "DELITO LSV art.384 CP - ATESTADO", actuacion: "Diligencias + denuncia 1.1.5A RGCond. NO copia + Inmovilización.", tipo: "delito" },
            "carecer-permiso": { hecho: "Carece de permiso válido (otro país/civil/militar)", resumen: "DELITO LSV art.384 CP - ATESTADO", actuacion: "Diligencias + denuncia 1.1.5A RGCond. NO copia + Inmovilización.", tipo: "delito" },

            // PSICOFÍSICAS
            "perdida-psicofisicas": { hecho: "Pérdida de vigencia por condiciones psicofísicas", resumen: "INFRACCIÓN RGCOND 1.1.5A (500€)", actuacion: "Denuncia + Inmovilización. NO penal.", tipo: "infraccion" },
            "sin-requisitos": { hecho: "Conducir sin mantener requisitos psicofísicos", resumen: "INFRACCIÓN RGCOND 12.6.5A (200€)", actuacion: "Denuncia. NO inmovilización. NO penal.", tipo: "infraccion" }
        };

        // --- Lógica ---
        let history = [];
        let currentSection = null;

        function initSupuestos() {
            const container = document.getElementById("supuestos-container");
            container.innerHTML = "";
            for (let key in decisionTrees) {
                const btn = document.createElement("button");
                btn.className = "btn btn-primary w-full";
                btn.textContent = key.replace(/-/g, " ").toUpperCase();
                btn.onclick = () => startQuestions(key);
                container.appendChild(btn);
            }
        }

        function startQuestions(sectionKey) {
            const container = document.getElementById("question-container");
            const resultDiv = document.getElementById("resultado");
            container.innerHTML = "";
            resultDiv.classList.add("hidden");
            history = [];
            currentSection = sectionKey;

            if (!sectionKey) return;
            const tree = decisionTrees[sectionKey];
            history.push(tree);
            showQuestion(tree);
        }

        function showQuestion(node) {
            const container = document.getElementById("question-container");
            container.innerHTML = `<p class=\"font-bold mb-2\">${node.question}</p>`;

            for (let key in node.options) {
                const btn = document.createElement("button");
                btn.className = "btn btn-primary w-full mt-2";
                btn.textContent = key.toUpperCase();
                btn.onclick = () => handleAnswer(node.options[key]);
                container.appendChild(btn);
            }

            const backBtn = document.createElement("button");
            backBtn.className = "btn btn-back w-full mt-4";
            backBtn.textContent = "VOLVER ATRÁS";
            backBtn.onclick = goBack;
            container.appendChild(backBtn);
        }

        function handleAnswer(nextNode) {
            if (typeof nextNode === "string") {
                showResult(nextNode);
            } else {
                history.push(nextNode);
                showQuestion(nextNode);
            }
        }

        function goBack() {
            const resultDiv = document.getElementById("resultado");
            if (!resultDiv.classList.contains("hidden")) {
                resultDiv.classList.add("hidden");
                history = [];
                showQuestion(decisionTrees[currentSection]);
                return;
            }

            if (history.length > 1) {
                history.pop();
                showQuestion(history[history.length - 1]);
            } else {
                document.getElementById("question-container").innerHTML = "";
                currentSection = null;
            }
        }

        function showResult(optionKey) {
            const resultDiv = document.getElementById("resultado");
            const detailDiv = document.getElementById("detalle-caso");
            const info = casos[optionKey];

            detailDiv.innerHTML = `
                <div><strong>Hecho:</strong> ${info.hecho}</div>
                <div><strong>Resumen:</strong> ${info.resumen}</div>
                <div><strong>Actuación:</strong> ${info.actuacion}</div>
            `;

            resultDiv.className = `result-box ${info.tipo}`;
            resultDiv.classList.remove("hidden");

            const container = document.getElementById("question-container");
            container.innerHTML = "";
            const backBtn = document.createElement("button");
            backBtn.className = "btn btn-back w-full mt-4";
            backBtn.textContent = "VOLVER ATRÁS";
            backBtn.onclick = goBack;
            container.appendChild(backBtn);
        }

        document.addEventListener("DOMContentLoaded", initSupuestos);
    </script>
</body>
</html>